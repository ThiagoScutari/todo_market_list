## Ata de Reunião - Projeto ToDo Market & List

**Data:** [Inserir Data da Reunião]
**Horário:** [Inserir Horário de Início] - [Inserir Horário de Fim]
**Participantes:** Alpha (Gerente), Architect (Tech Lead), Experience, Builder

---

### 1. Discussão sobre o "Cérebro" NLP do Sistema

*   **Objetivo:** Criar o script `processador_nlp.py` para converter texto natural em JSON estruturado para a API.
*   **Responsável pela Discussão:** Alpha (Gerente)
*   **Questões Levantadas:**
    *   **Architect:** Como garantir que a saída do LLM (Gemini) seja JSON válido e não texto solto?
    *   **Experience:** O que acontece se o modelo não entender a unidade de medida?

### 2. Estratégias para Garantir Saída JSON Válida (Proposta do Architect)

*   **1. Prompt Engineering Estruturado:**
    *   Instruir explicitamente o Gemini a retornar **exclusivamente** JSON, sem texto adicional.
    *   Definir a estrutura JSON esperada com chaves: `nome`, `quantidade`, `unidade`, `categoria`.
*   **2. Validação Pós-Processamento:**
    *   Utilizar `json.loads()` no Python para validar a resposta. Falha na conversão indica saída inválida.
*   **3. Uso de Schema de Saída:**
    *   Recomenda-se instruir o modelo a seguir um schema pré-definido.
*   **4. Fallback e Retentativas:**
    *   Implementar retentativas automáticas do prompt em caso de JSON inválido.
    *   Considerar métodos alternativos (regex) como último recurso.
    *   Retornar erro claro para o sistema chamador em caso de falha total.
*   **5. Tratamento de Campos Opcionais:**
    *   Instruir o modelo sobre como lidar com omissões (ex: categoria indefinida), definindo valores padrão ou nulos.
*   **Status:** Estratégia técnica discutida e validada.

### 3. Gestão de Unidades de Medida e Ambiguidade (Discussão com Experience)

*   **Pergunta:** O que acontece se o modelo não entender a unidade de medida?
*   **Discussão:**
    *   O prompt deverá orientar o modelo a:
        *   **Inferir**, quando possível.
        *   **Retornar nulo** ou valor padrão caso a unidade seja desconhecida.
    *   O módulo Python poderá complementar a validação, aplicando normalizações ou regras internas.
*   **Status:** Diretriz estabelecida; detalhes serão incorporados ao prompt final.

### 4. Visão Técnica Geral do Projeto (Reiterada pelo Architect)

*   **Orquestração:** `n8n` como backbone.
*   **Linguagem de Scripting:** Python para lógica complementar.
*   **IA Resiliente:** Gemini (primário) e OpenAI (fallback).
*   **Banco de Dados:** PostgreSQL (principal) e SQLite (desenvolvimento).
*   **Frontends de Dados:** Notion e Google Workspace.
*   **Módulos Principais:** Lista de compras, Orçamento Doméstico, Eventos/Tarefas.
*   **Interfaces de Entrada:** Telegram (principal) e WhatsApp (rápidas).
*   **Desafios Técnicos:** Sincronização, performance do `n8n`, qualidade da extração de IA, escalabilidade.
*   **Status:** Marco conceitual reconfirmado e alinhado com o módulo NLP.

### 5. Criação do Script `processador_nlp.py`

*   **Responsável pela Ordem:** Usuario (com base nas instruções do Alpha e Architect)
*   **Responsável pela Execução:** Builder
*   **Requisitos do Script:**
    1.  Usar `langchain_google_genai` para configurar o modelo Gemini Lite.
    2.  Criar a função `interpretar_pedido(texto)` que envia um prompt pedindo JSON estrito (sem markdown).
    3.  O prompt deve listar as categorias válidas ('Hortifrúti', 'Padaria', 'Carnes', 'Limpeza').
    4.  Realizar tratamento da string de resposta (remover `json` e ``` antes de converter para dict).
    5.  Usar `requests.post` para enviar o JSON para `http://127.0.0.1:5000/item`.
    6.  No bloco `if __name__ == '__main__':`, testar com a frase: 'Preciso comprar 3kg de costela para o churrasco'.
*   **Status:** Script `processador_nlp.py` criado conforme os requisitos.

---

**Próximos Passos Sugeridos:**

*   Definir e versionar o prompt final utilizado pelo script `processador_nlp.py`.
*   Implementar módulo de validação de JSON e mecanismos de fallback (se necessário, com base nos testes).
*   Preparar testes unitários simulando entradas variadas.

---

**Fim da Ata.**