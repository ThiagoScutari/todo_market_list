**Ata da Reunião - Planejamento de Deploy (Sprint 5)**

**Data:** 26 de Maio de 2024
**Horário:** 08:43 - 09:06 (aproximadamente)
**Participantes:** Usuário (Alpha), Architect, Builder, Experience

**Assunto:** Planejamento estratégico para o deploy da aplicação em um ambiente de produção na VPS HostGator, com foco na integração com a infraestrutura Docker e Traefik existente.

---

**Pauta e Decisões:**

1.  **Objetivo Inicial e Descoberta Chave:**
    *   A Sprint 5 foi iniciada com o objetivo de realizar o deploy da aplicação na VPS disponível, que já hospeda o serviço n8n.
    *   Uma descoberta crucial foi feita: a VPS não apenas usa Docker, mas também o reverse proxy **Traefik** para gerenciar o tráfego e os serviços.

2.  **Mudança de Estratégia:**
    *   A estratégia inicial de criar um `docker-compose.yml` autônomo foi descartada.
    *   A nova diretriz, aprovada por todos, é **integrar a aplicação como um novo serviço** no arquivo `docker-compose.yml` já existente na VPS, aproveitando a infraestrutura de Traefik.

3.  **Decisões Técnicas Finais (Consolidado):**
    *   **Banco de Dados:** Foi decidido **manter o SQLite** para acelerar o deploy. Para mitigar o risco de concorrência (`database is locked`), o servidor de produção Gunicorn será configurado para rodar com um **único worker (`--workers 1`)**.
    *   **Orquestração:** A aplicação será definida como um serviço chamado `familyos-app` no `docker-compose.yml` existente.
    *   **Exposição da API:** A API será exposta publicamente através de um **subdomínio dedicado** (ex: `api.thiagoscutari.com.br`). O Traefik será responsável por:
        *   Roteamento do tráfego do subdomínio para o contêiner da aplicação.
        *   Provisionamento e renovação automática de certificados SSL (HTTPS) via Let's Encrypt.
        *   A configuração será feita inteiramente via `labels` do Docker no serviço `familyos-app`, sem a necessidade de alterar arquivos de configuração do Traefik.
    *   **Persistência de Dados:** Um **volume Docker** será configurado para mapear o diretório `src` do contêiner (onde o `todo_market.db` reside) para um diretório no disco da VPS, garantindo a durabilidade dos dados.

4.  **Plano de Testes e Validação:**
    *   **Pré-requisito:** É necessário criar um **Registro A** na zona de DNS da HostGator, apontando o subdomínio escolhido para o endereço IP público da VPS.
    *   **Validação do Deploy:** Após a execução do `docker-compose up`, a validação seguirá os seguintes passos:
        1.  Verificação dos logs do contêiner (`docker-compose logs -f familyos-app`) para confirmar a inicialização sem erros.
        2.  Verificação do dashboard do Traefik para confirmar que o novo serviço e roteador foram detectados e estão saudáveis.
        3.  Teste direto do endpoint (`https://subdominio.escolhido/magic`) via `curl` ou Postman.
    *   **Teste End-to-End:** O teste final consistirá em atualizar o workflow do n8n para usar a nova URL pública e executar o fluxo completo, desde o Telegram até a API.

---

**Ações Executadas (Pós-Reunião):**

O Builder, seguindo a ordem técnica imediata, gerou os seguintes artefatos de deploy, alinhados com as especificações do Architect:

1.  **`requirements.txt`:** Arquivo com as dependências Python de produção, incluindo `gunicorn`.
2.  **`Dockerfile`:** Receita para construir a imagem Docker da aplicação, configurada para rodar com Gunicorn e um único worker.
3.  **`docker-compose-snippet.yaml`:** Trecho de código YAML contendo a definição completa do serviço `familyos-app`, incluindo as `labels` do Traefik, pronto para ser inserido no `docker-compose.yml` existente na VPS.

---

**Próximos Passos:**

1.  Realizar a configuração do Registro A no DNS.
2.  Transferir os artefatos gerados (`Dockerfile`, `requirements.txt`, código-fonte) para a VPS.
3.  Integrar o `docker-compose-snippet.yaml` ao arquivo `docker-compose.yml` principal na VPS.
4.  Executar o deploy com o comando `docker-compose up -d --build familyos-app`.
5.  Executar o plano de testes e validação.